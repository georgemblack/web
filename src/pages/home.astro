---
import { getCombined } from "../util/Api";
import { subtitle, url, preview, readMore, isPost } from "../util/Format";
import Page from "../layouts/Page.astro";

const combined = await getCombined();
const visible = combined.filter((item) => {
  if (isPost(item)) return item.visible;
  return true;
});
---

<Page title="Home">
  <div class="bio">
    <picture>
      <img src="/images/profile.avif" alt="George Black profile distorted" />
    </picture>
    <div>
      <p>
        Software engineer working in Austin (but Wisconsin is home 🐄). Send me
        a message at <a href="mailto:contact@george.black"
          >contact@george.black</a
        >.
      </p>
      <form
        class="search"
        method="get"
        id="search"
        action="https://duckduckgo.com/"
      >
        <input type="hidden" name="sites" value="george.black" />
        <input
          type="text"
          name="q"
          maxlength="255"
          placeholder="Search this site..."
          autocomplete="off"
        />
      </form>
    </div>
  </div>
  {
    visible.map((item) => (
      <article style="margin-bottom: 6em;">
        <h1>
          <a href={url(item)}>{item.title}</a>
        </h1>
        <p class="subtitle">{subtitle(item)}</p>

        <Fragment set:html={preview(item)} />
        {readMore(item) && (
          <a class="read-more-button" href={url(item)}>
            <p>Read More &#8594;</p>
          </a>
        )}
      </article>
    ))
  }
  <p><a href="/writing">Go to all writing</a></p>
</Page>
